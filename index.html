from flask import Flask, request, jsonify
import base64

app = Flask(__name__)

def embed_watermark(text):
    # Embed zero-width Unicode characters
    watermark = "\u200B\u200C\u200D"  # Example zero-width characters
    return watermark + text + watermark

def add_decoy_patterns(text):
    # Add decoy patterns (e.g., random invisible characters)
    decoy = "\uFEFF" * 5  # Zero-width no-break space
    return decoy + text + decoy

@app.route('/bypass', methods=['POST'])
def bypass():
    try:
        data = request.get_json()
        input_text = data.get('text', '').strip()
        if not input_text:
            return jsonify({"error": "No input text provided"}), 400

        # Process the text
        watermarked_text = embed_watermark(input_text)
        decoy_text = add_decoy_patterns(watermarked_text)
        processed_text = base64.b64encode(decoy_text.encode()).decode()

        # Generate Unicode hash
        unicode_hash = base64.b64encode("\u200B\u200C\u200D".encode()).decode()

        return jsonify({
            "processed_text": processed_text,
            "unicode_hash": unicode_hash
        }), 200
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route('/download', methods=['POST'])
def download():
    try:
        data = request.get_json()
        input_text = data.get('text', '').strip()
        if not input_text:
            return jsonify({"error": "No input text provided"}), 400

        # Process the text
        watermarked_text = embed_watermark(input_text)
        decoy_text = add_decoy_patterns(watermarked_text)

        # Create downloadable file
        with open("watermarked_output.txt", "w", encoding="utf-8") as f:
            f.write(decoy_text)

        return jsonify({"message": "File created successfully"}), 200
    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
